<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core\StateManager.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AnimationManager.html">AnimationManager</a></li>
            
                <li><a href="../classes/AssetLoader.html">AssetLoader</a></li>
            
                <li><a href="../classes/BaseTexture.html">BaseTexture</a></li>
            
                <li><a href="../classes/BitmapFontLoader.html">BitmapFontLoader</a></li>
            
                <li><a href="../classes/BitmapText.html">BitmapText</a></li>
            
                <li><a href="../classes/Button.html">Button</a></li>
            
                <li><a href="../classes/Camera.html">Camera</a></li>
            
                <li><a href="../classes/Canvas.html">Canvas</a></li>
            
                <li><a href="../classes/CanvasGraphics.html">CanvasGraphics</a></li>
            
                <li><a href="../classes/CanvasRenderer.html">CanvasRenderer</a></li>
            
                <li><a href="../classes/Circle.html">Circle</a></li>
            
                <li><a href="../classes/Color.html">Color</a></li>
            
                <li><a href="../classes/CustomRenderable.html">CustomRenderable</a></li>
            
                <li><a href="../classes/DebugUtils.html">DebugUtils</a></li>
            
                <li><a href="../classes/DisplayObject.html">DisplayObject</a></li>
            
                <li><a href="../classes/DisplayObjectContainer.html">DisplayObjectContainer</a></li>
            
                <li><a href="../classes/Ellipse.html">Ellipse</a></li>
            
                <li><a href="../classes/EventTarget.html">EventTarget</a></li>
            
                <li><a href="../classes/Frame.html">Frame</a></li>
            
                <li><a href="../classes/FrameData.html">FrameData</a></li>
            
                <li><a href="../classes/Graphics.html">Graphics</a></li>
            
                <li><a href="../classes/ImageLoader.html">ImageLoader</a></li>
            
                <li><a href="../classes/JsonLoader.html">JsonLoader</a></li>
            
                <li><a href="../classes/MovieClip.html">MovieClip</a></li>
            
                <li><a href="../classes/Phaser.Animation.html">Phaser.Animation</a></li>
            
                <li><a href="../classes/Point.html">Point</a></li>
            
                <li><a href="../classes/Polygon.html">Polygon</a></li>
            
                <li><a href="../classes/PolyK._convex.html">PolyK._convex</a></li>
            
                <li><a href="../classes/PolyK._PointInTriangle.html">PolyK._PointInTriangle</a></li>
            
                <li><a href="../classes/PolyK.AjaxRequest.html">PolyK.AjaxRequest</a></li>
            
                <li><a href="../classes/PolyK.InteractionData.html">PolyK.InteractionData</a></li>
            
                <li><a href="../classes/PolyK.InteractionManager.html">PolyK.InteractionManager</a></li>
            
                <li><a href="../classes/Rectangle.html">Rectangle</a></li>
            
                <li><a href="../classes/RenderTexture.html">RenderTexture</a></li>
            
                <li><a href="../classes/Sound.html">Sound</a></li>
            
                <li><a href="../classes/SoundManager.html">SoundManager</a></li>
            
                <li><a href="../classes/Spine.html">Spine</a></li>
            
                <li><a href="../classes/Sprite.html">Sprite</a></li>
            
                <li><a href="../classes/SpriteSheetLoader.html">SpriteSheetLoader</a></li>
            
                <li><a href="../classes/Stage.html">Stage</a></li>
            
                <li><a href="../classes/Text.html">Text</a></li>
            
                <li><a href="../classes/Texture.html">Texture</a></li>
            
                <li><a href="../classes/TilingSprite.html">TilingSprite</a></li>
            
                <li><a href="../classes/Time.html">Time</a></li>
            
                <li><a href="../classes/Utils.html">Utils</a></li>
            
                <li><a href="../classes/WebGLBatch.html">WebGLBatch</a></li>
            
                <li><a href="../classes/WebGLRenderer.html">WebGLRenderer</a></li>
            
                <li><a href="../classes/World.html">World</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Phaser.html">Phaser</a></li>
            
                <li><a href="../modules/Phaser.Animation.html">Phaser.Animation</a></li>
            
                <li><a href="../modules/Phaser.Animation.FrameData.html">Phaser.Animation.FrameData</a></li>
            
                <li><a href="../modules/Phaser.Button.html">Phaser.Button</a></li>
            
                <li><a href="../modules/Phaser.Camera.html">Phaser.Camera</a></li>
            
                <li><a href="../modules/Phaser.Canvas.html">Phaser.Canvas</a></li>
            
                <li><a href="../modules/Phaser.Stage.html">Phaser.Stage</a></li>
            
                <li><a href="../modules/Phaser.Time.html">Phaser.Time</a></li>
            
                <li><a href="../modules/Phaser.Utils.html">Phaser.Utils</a></li>
            
                <li><a href="../modules/Phaser.World.html">Phaser.World</a></li>
            
                <li><a href="../modules/PIXI.html">PIXI</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: core\StateManager.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
Phaser.StateManager = function (game, pendingState) {

	this.game = game;

	this.states = {};

	if (pendingState !== null)
	{
		this._pendingState = pendingState;
	}

};

Phaser.StateManager.prototype = {
	
	/**
	* @type {Phaser.Game}
	*/
	game: null,

	/**
	* The state to be switched to in the next frame.
	* @type {State}
	*/
	_pendingState: null,

	/**
	* Flag that sets if the State has been created or not.
	* @type {Boolean}
	*/
	_created: false,

	/**
	* The state to be switched to in the next frame.
	* @type {Object}
	*/
	states: {},

	/**
	* The current active State object (defaults to null)
	* @type {String}
	*/
	current: &#x27;&#x27;,
	
	/**
	* This will be called when the state is started (i.e. set as the current active state)
	* @type {function}
	*/
	onInitCallback: null,

	/**
	* This will be called when init states. (loading assets...)
	* @type {function}
	*/
	onPreloadCallback: null,
	
	/**
	* This will be called when create states. (setup states...)
	* @type {function}
	*/
	onCreateCallback: null,

	/**
	* This will be called when State is updated, this doesn&#x27;t happen during load (see onLoadUpdateCallback)
	* @type {function}
	*/
	onUpdateCallback: null,

	/**
	* This will be called when the State is rendered, this doesn&#x27;t happen during load (see onLoadRenderCallback)
	* @type {function}
	*/
	onRenderCallback: null,

	/**
	* This will be called before the State is rendered and before the stage is cleared
	* @type {function}
	*/
	onPreRenderCallback: null,

	/**
	* This will be called when the State is updated but only during the load process
	* @type {function}
	*/
	onLoadUpdateCallback: null,

	/**
	* This will be called when the State is rendered but only during the load process
	* @type {function}
	*/
	onLoadRenderCallback: null,

	/**
	* This will be called when states paused.
	* @type {function}
	*/
	onPausedCallback: null,

	/**
	* This will be called when the state is shut down (i.e. swapped to another state)
	* @type {function}
	*/
	onShutDownCallback: null,

	boot: function () {

		// console.log(&#x27;Phaser.StateManager.boot&#x27;);

		if (this._pendingState !== null)
		{
			// console.log(&#x27;_pendingState found&#x27;);
			// console.log(typeof this._pendingState);

			if (typeof this._pendingState === &#x27;string&#x27;)
			{
				//	State was already added, so just start it
				this.start(this._pendingState, false, false);
			}
			else
			{
				this.add(&#x27;default&#x27;, this._pendingState, true);
			}

		}

	},

	/**
    * Add a new State.
    * @param key {String} A unique key you use to reference this state, i.e. &quot;MainMenu&quot;, &quot;Level1&quot;.
    * @param state {State} The state you want to switch to.
    * @param autoStart {Boolean} Start the state immediately after creating it? (default true)
    */
    add: function (key, state, autoStart) {

        if (typeof autoStart === &quot;undefined&quot;) { autoStart = false; }

		// console.log(&#x27;Phaser.StateManager.addState&#x27;, key);
		// console.log(typeof state);
		// console.log(&#x27;autoStart?&#x27;, autoStart);

		var newState;

		if (state instanceof Phaser.State)
		{
			// console.log(&#x27;Phaser.StateManager.addState: Phaser.State given&#x27;);
			newState = state;
		}
		else if (typeof state === &#x27;object&#x27;)
		{
			// console.log(&#x27;Phaser.StateManager.addState: Object given&#x27;);
			newState = state;
			newState.game = this.game;
		}
		else if (typeof state === &#x27;function&#x27;)
		{
			// console.log(&#x27;Phaser.StateManager.addState: Function given&#x27;);
			newState = new state(this.game);
		}

		this.states[key] = newState;

		if (autoStart)
		{
			if (this.game.isBooted)
			{
				// console.log(&#x27;Game is booted, so we can start the state now&#x27;);
				this.start(key);
			}
			else
			{
				// console.log(&#x27;Game is NOT booted, so set the current state as pending&#x27;);
				this._pendingState = key;
			}
		}

		return newState;

    },

    remove: function (key) {

    	if (this.current == key)
    	{
	        this.callbackContext = null;

	        this.onInitCallback = null;
	        this.onShutDownCallback = null;

	        this.onPreloadCallback = null;
	        this.onLoadRenderCallback = null;
	        this.onLoadUpdateCallback = null;
	        this.onCreateCallback = null;
	        this.onUpdateCallback = null;
	        this.onRenderCallback = null;
	        this.onPausedCallback = null;
	        this.onDestroyCallback = null;
    	}

    	delete this.states[key];

    },

	/**
    * Start the given state
    * @param key {String} The key of the state you want to start.
    * @param [clearWorld] {bool} clear everything in the world? (Default to true)
    * @param [clearCache] {bool} clear asset cache? (Default to false and ONLY available when clearWorld=true)
    */
    start: function (key, clearWorld, clearCache) {

    	// console.log(&#x27;Phaser.StateManager.start&#x27;, key);
    	// console.log(this);
    	// console.log(this.callbackContext);

        if (typeof clearWorld === &quot;undefined&quot;) { clearWorld = true; }
        if (typeof clearCache === &quot;undefined&quot;) { clearCache = false; }

        if (this.game.isBooted == false)
        {
			// console.log(&#x27;Game is NOT booted, so set the requested state as pending&#x27;);
			this._pendingState = key;
			return;
        }

		if (this.checkState(key) == false)
		{
			return;
		}
		else
		{
			//	Already got a state running?
			if (this.current)
			{
				this.onShutDownCallback.call(this.callbackContext);
			}

	        if (clearWorld) {

	            this.game.world.destroy();

	            if (clearCache == true)
	            {
	                this.game.cache.destroy();
	            }
	        }

			this.setCurrentState(key);
		}

        if (this.onPreloadCallback)
        {
	    	// console.log(&#x27;Preload Callback found&#x27;);
            this.game.load.reset();
            this.onPreloadCallback.call(this.callbackContext);

            //  Is the loader empty?
            if (this.game.load.queueSize == 0)
            {
		    	// console.log(&#x27;Loader queue empty&#x27;);
                this.game.loadComplete();

                if (this.onCreateCallback)
                {
                    this.onCreateCallback.call(this.callbackContext);
                }

				this._created = true;
            }
            else
            {
		    	// console.log(&#x27;Loader started&#x27;);
                //  Start the loader going as we have something in the queue
                this.game.load.start();
            }
        }
        else
        {
			// console.log(&#x27;Preload callback not found&#x27;);
            //  No init? Then there was nothing to load either
            if (this.onCreateCallback)
            {
				// console.log(&#x27;Create callback found&#x27;);
                this.onCreateCallback.call(this.callbackContext);
            }

			this._created = true;

            this.game.loadComplete();
        }

    },

	//	Used by onInit and onShutdown when those functions don&#x27;t exist on the state
    dummy: function () {
    },

    checkState: function (key) {

		if (this.states[key])
		{
			var valid = false;

			if (this.states[key][&#x27;preload&#x27;]) { valid = true; }

			if (valid == false &amp;&amp; this.states[key][&#x27;loadRender&#x27;]) { valid = true; }
			if (valid == false &amp;&amp; this.states[key][&#x27;loadUpdate&#x27;]) { valid = true; }
			if (valid == false &amp;&amp; this.states[key][&#x27;create&#x27;]) { valid = true; }
			if (valid == false &amp;&amp; this.states[key][&#x27;update&#x27;]) { valid = true; }
			if (valid == false &amp;&amp; this.states[key][&#x27;preRender&#x27;]) { valid = true; }
			if (valid == false &amp;&amp; this.states[key][&#x27;render&#x27;]) { valid = true; }
			if (valid == false &amp;&amp; this.states[key][&#x27;paused&#x27;]) { valid = true; }

        	if (valid == false)
        	{
	            console.warn(&quot;Invalid Phaser State object given. Must contain at least a one of the required functions.&quot;);
	            return false;
	        }

			return true;
		}
		else
		{
			console.warn(&quot;Phaser.StateManager - No state found with the key: &quot; + key);
			return false;
		}

    },

    link: function (key) {

		// console.log(&#x27;linked&#x27;);
        this.states[key].game = this.game;
        this.states[key].add = this.game.add;
        this.states[key].camera = this.game.camera;
        this.states[key].cache = this.game.cache;
        this.states[key].input = this.game.input;
        this.states[key].load = this.game.load;
        this.states[key].math = this.game.math;
        this.states[key].sound = this.game.sound;
        this.states[key].stage = this.game.stage;
        this.states[key].time = this.game.time;
        this.states[key].tweens = this.game.tweens;
        this.states[key].world = this.game.world;
        this.states[key].particles = this.game.particles;
        this.states[key].physics = this.game.physics;
        this.states[key].rnd = this.game.rnd;

    },

	setCurrentState: function (key) {

        this.callbackContext = this.states[key];

        this.link(key);

        //	Used when the state is set as being the current active state
        this.onInitCallback = this.states[key][&#x27;init&#x27;] || this.dummy;

        this.onPreloadCallback = this.states[key][&#x27;preload&#x27;] || null;
        this.onLoadRenderCallback = this.states[key][&#x27;loadRender&#x27;] || null;
        this.onLoadUpdateCallback = this.states[key][&#x27;loadUpdate&#x27;] || null;
        this.onCreateCallback = this.states[key][&#x27;create&#x27;] || null;
        this.onUpdateCallback = this.states[key][&#x27;update&#x27;] || null;
        this.onPreRenderCallback = this.states[key][&#x27;preRender&#x27;] || null;
        this.onRenderCallback = this.states[key][&#x27;render&#x27;] || null;
        this.onPausedCallback = this.states[key][&#x27;paused&#x27;] || null;

        //	Used when the state is no longer the current active state
        this.onShutDownCallback = this.states[key][&#x27;shutdown&#x27;] || this.dummy;

		this.current = key;
		this._created = false;

		this.onInitCallback.call(this.callbackContext);

	},

    loadComplete: function () {

		// console.log(&#x27;Phaser.StateManager.loadComplete&#x27;);

        if (this._created == false &amp;&amp; this.onCreateCallback)
        {
			// console.log(&#x27;Create callback found&#x27;);
            this._created = true;
            this.onCreateCallback.call(this.callbackContext);
        }

    },

    update: function () {

    	if (this._created &amp;&amp; this.onUpdateCallback)
    	{
			this.onUpdateCallback.call(this.callbackContext);
    	}
    	else
    	{
		    if (this.onLoadUpdateCallback)
		    {
		    	this.onLoadUpdateCallback.call(this.callbackContext);
			}
		}

    },

    preRender: function () {

	    if (this.onPreRenderCallback)
	    {
	    	this.onPreRenderCallback.call(this.callbackContext);
		}

    },

    render: function () {

    	if (this._created &amp;&amp; this.onRenderCallback)
    	{
			this.onRenderCallback.call(this.callbackContext);
    	}
    	else
    	{
		    if (this.onLoadRenderCallback)
		    {
		    	this.onLoadRenderCallback.call(this.callbackContext);
			}
		}

    },

	/**
    * Nuke the entire game from orbit
    */
    destroy: function () {

        this.callbackContext = null;

        this.onInitCallback = null;
        this.onShutDownCallback = null;

        this.onPreloadCallback = null;
        this.onLoadRenderCallback = null;
        this.onLoadUpdateCallback = null;
        this.onCreateCallback = null;
        this.onUpdateCallback = null;
        this.onRenderCallback = null;
        this.onPausedCallback = null;
        this.onDestroyCallback = null;

        this.game = null;
        this.states = {};
        this._pendingState = null;

    }

};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
